"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var DataTable=function(){function a(e,t,i,n){_classCallCheck(this,a),this.version="2.3.0",this.table=e,this.userOptions=t,this.eventOptions=i,this.translations=n,this.elements={columnRowSelector:".js-table-columns",filterRowSelector:".js-table-filters",filterSelectColumn:".js-select-filter",filterInputColumn:".js-input-filter"},this.prefix={throw:"w2wDataTables: "},this.defaultOptions={language:"en",stateSaving:!0,dom:'<"row"<"col-md-4"f><"col-md-4 col-md-offset-4 text-right">>trlip<"clear">',buttons:[],showAlertForXhrInactivity:!0,handleXhrInactivity:function(){},showAlertForErrors:!0,handleErrors:function(){}},this.globals={options:{},source:e.data("source"),columnFilter:e.data("column-filter"),autoReload:e.data("auto-reload"),perPage:e.data("per-page"),tableID:e.attr("id"),serverSide:!0,table:!1,state:!1,translations:{},debounceDelay:250},this.events={"draw.dt":[this.recalc.bind(this)],"init.dt":[],initComplete:[],"xhr.dt":[this.onXhr.bind(this)],"error.dt":[this.onError.bind(this)]},$.fn.dataTable.ext.errMode="none"}return _createClass(a,[{key:"onXhr",value:function(e,t,i,n){if(200!==n.status){if(403!==n.status||"CSRF token validation failed"!==n.responseJSON.error)throw t.oInit.showAlertForErrors&&alert("Something went wrong. The administrator has been notified. Please try again later."),t.oInit.handleErrors(),this.prefix.throw+"Ajax call returned a "+n.status+" status code";t.oInit.showAlertForXhrInactivity&&alert("You need to refresh the page due to an extended period of inactivity"),t.oInit.handleXhrInactivity()}}},{key:"onError",value:function(e,t,i,n){if(7!==i)throw t.oInit.showAlertForErrors&&alert("Something went wrong. The administrator has been notified. Please try again later."),t.oInit.handleErrors(),this.prefix.throw+n}},{key:"init",value:function(){this.globals.options=this.getOptions(),this.globals.translations=this.getTranslations(),this.globals.options.buttons=this.getFilters(),this.hasRequirementsOrThrow(),this.getEventOptions(),this.makeTable()}},{key:"getOptions",value:function(){return $.extend(this.defaultOptions,this.userOptions)}},{key:"getTranslations",value:function(){return this.translations.get(this.globals.options.language)}},{key:"getEventOptions",value:function(){$.each(this.eventOptions,function(e,t){this.events[e]=$.extend({},this.events[e],t||{})})}},{key:"hasRequirementsOrThrow",value:function(){var e=this.table.find(this.elements.columnRowSelector);if(void 0!==this.globals.source&&""!==this.globals.source||(this.globals.serverSide=!1),void 0===this.globals.tableID||""===this.globals.tableID)throw this.prefix.throw+"missing id attribute!";if(0===e.length)throw this.prefix.throw+"missing column row ("+this.elements.columnRowSelector+")!";if(void 0!==this.globals.autoReload&&0<!this.globals.autoReload)throw this.prefix.throw+"invalid reload interval!";if(void 0!==this.globals.perPage&&0<!this.globals.perPage)throw this.prefix.throw+"invalid amount per page!"}},{key:"makeTable",value:function(){var e={autoWidth:!1,columns:this.getColumns(),initComplete:function(){0<e.component.table.find(e.component.elements.filterRowSelector).length&&e.component.filterColumn(),e.component.triggerEvent("initComplete")},order:this.getOrder(),orderCellsTop:!0,processing:!0,responsive:!0,serverSide:this.globals.serverSide,stateSave:this.globals.options.stateSaving,component:this},t=this;if($.extend(e,this.globals.options),e.language=this.globals.translations,1==this.globals.serverSide&&(e.ajax={method:"POST",url:this.globals.source}),!this.table)throw"Unknown element for the datatable!";this.globals.table=this.table.DataTable(e),this.globals.state=this.globals.table.state.loaded(),this.setFilterValues(),void 0!==this.globals.autoReload&&this.bindReload(this.globals.autoReload),void 0!==this.globals.perPage&&(this.globals.options.perPage=this.globals.perPage),void 0!==this.globals.options.perPage&&this.setPageLength(),this.globals.table.on("init.dt",function(){t.triggerEvent("init.dt")}),$.each(this.events,this.listenToEvent.bind(this)),1!=this.globals.serverSide&&this.filterColumn()}},{key:"addEvent",value:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}},{key:"listenToEvent",value:function(e){var t=this;this.globals.table.on(e,function(){t.triggerEvent(e,arguments)})}},{key:"triggerEvent",value:function(e,i){this.events[e]&&$.each(this.events[e],function(e,t){t.apply(this,i)})}},{key:"setPageLength",value:function(){this.globals.table.page.len(this.globals.options.perPage).draw()}},{key:"getColumns",value:function(){var e=this.table.find(this.elements.columnRowSelector+" th"),l=[];return e.each(function(){var e=[!0,!1],t=$(this),i=t.data("name"),n=t.data("data"),a=t.data("orderable"),o=t.data("searchable");void 0===n&&(n=i),void 0!==a&&e.indexOf(a)||(a=!0),void 0!==o&&e.indexOf(o)||(o=!0),l.push({data:n,name:i,orderable:a,searchable:o})}),l}},{key:"getOrder",value:function(){var e=this.table.find('[data-default-sort="true"]'),t=e.data("default-sort-order");if(0===e.length)return[[0,"desc"]];if(void 0===t)throw this.prefix.throw+'You must add a sorting order (default-sort-order="asc/desc") if you are filtering on a custom column!';if(-1==["asc","desc"].indexOf(t))throw this.prefix.throw+"You must add a valid sorting order (asc/desc) if you are filtering on a custom column!";return[[e.index(),t]]}},{key:"filterColumn",value:function(){var i=this;i.globals.table&&i.globals.table.columns().eq(0).each(function(e){var t=i.table.find(i.elements.filterRowSelector+" th:eq("+e+")");i.table.find(i.elements.columnRowSelector+" th:eq("+e+")");i.initFilterSelect(e,t),i.initFilterInput(e,t)})}},{key:"initFilterInput",value:function(n,e){var a=this,t=a.debounce(function(e,t){var i=$(this).val();t&&!i||a.globals.table.column(n).search(i).draw()},a.globals.debounceDelay);e.find(a.elements.filterInputColumn).on("input",t),e.find(a.elements.filterInputColumn).on("change",t),e.find(a.elements.filterInputColumn).each(t)}},{key:"initFilterSelect",value:function(n,e){var a=this,t=a.debounce(function(e,t){var i=$(this).val();t&&!i||a.globals.table.column(n).search(a.searchString(i),!0,!1).draw()},a.globals.debounceDelay);e.find(a.elements.filterSelectColumn).on("change",t),e.find(a.elements.filterSelectColumn).each(t)}},{key:"searchString",value:function(e,t){var i=1<arguments.length&&void 0!==t?t:"|",n=e;return!n||Array.isArray(n)&&n.length<1?"":(Array.isArray(n)&&0<n.length&&(n=n.join(i)),"^"+n+"$")}},{key:"bindReload",value:function(e){setInterval(function(){this.globals.table.ajax.reload()},e)}},{key:"debounce",value:function(i,n,a){var o;return function(){var e=this,t=arguments;clearTimeout(o),o=setTimeout(function(){o=null,a||i.apply(e,t)},n),a&&!o&&i.apply(e,t)}}},{key:"recalc",value:function(){this.globals.table&&this.globals.table.responsive.recalc()}},{key:"setFilterValues",value:function(){var n=this;n.globals.state&&n.globals.state.columns&&$.each(n.globals.state.columns,function(e,t){var i=t.search.search;i&&(t.search.regex&&(i=i.slice(1,-1)),n.table.find(n.elements.filterRowSelector+" th").eq(e).find(".form-control").val(i))})}},{key:"getFilters",value:function(){var e=this.table.find(this.elements.columnRowSelector+" th"),n={},a=[],o=[],l=this;return l.globals.options.buttons&&(a=this.globals.options.buttons),e.each(function(){var e=$(l),i=e.data("name"),t=e.data("filter");t&&$.each(t.split("|"),function(e,t){n[t]||(n[t]=[]),n[t].indexOf(i+":name")<0&&n[t].push(i+":name")}),o.push(i+":name")}),$.each(n,function(e,t){var i=o.filter(function(e){return t.indexOf(e)<0});a.push({extend:"colvisGroup",text:e,show:t,hide:i})}),!jQuery.isEmptyObject(n)&&0<a.length&&a.push({extend:"colvisGroup",text:l.globals.translations.all,show:o,hide:[]}),1==l.globals.columnFilter&&a.push({extend:"colvis",text:'<i class="fa fa-columns"></i> '+l.globals.translations.columns}),a}},{key:"getTable",value:function(){return this.globals.table}}]),a}();"undefined"!=typeof module&&module.exports&&(module.exports=DataTable);
//# sourceMappingURL=datatables.core.js.map
